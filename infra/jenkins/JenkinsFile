pipeline {
  agent any
    stages {
      stage ("Compile") {
        steps {
          git branch: 'main', url: 'https://github.com/BeentageBand/SpringBootREST'
          sh "mvn compile"
        }
      }
      stage ("Test") {
        steps {
          sh "mvn test"
        }
      }
      stage ("Deploy") {
        steps {
          ansiblePlayBook('infra/ansible/deploy.yml') {
              inventoryPath('~/hosts')
              credentialsId('~/.ssh/jenkins.pem')
              tags('SpringBootREST')
              becomeUser('ubuntu')
          }
        }
      }
    }
}
