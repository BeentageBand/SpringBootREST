---
- hosts: all

  become: yes
  become_method: sudo
  remote_user: ubuntu
  vars:
    worskpace: {{ lookup('env', 'WORKSPACE') }}

  tasks:
  - name: Update apt and
    apt:
      update_cache: yes
      cache_valid_time: 86400 # One day
  - name: Install unzip
    apt:
      name: unzip

  - name: Upload WAR file
    copy:
      src: '{{ workspace }}/target/demo-0.0.1-SNAPSHOT.war' # relative 
      dest: /usr/local/tomcat/webapps/demo.war
      backup: yes

  handlers:
    - name: restart tomcat
      service:
        name: tomcat
        state: restarted
  
